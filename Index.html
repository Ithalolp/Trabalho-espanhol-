<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Semáforo do Subjuntivo — Batalha</title>
<style>
  :root{
    --bg1:#071022; --bg2:#071833;
    --card:#071a2b; --muted:#9fb0c8;
    --glass: rgba(255,255,255,0.03);
    --accent:#00eaff; --accent-2:#7dd3fc;
    --green:#16a34a; --red:#ef4444; --yellow:#f59e0b;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Arial;margin:0}
  body{
    min-height:100vh; background: linear-gradient(180deg,var(--bg1),var(--bg2));
    display:flex;flex-direction:column;align-items:center;justify-content:center;padding:22px;color:#e9f6ff;
  }
  .app{
    width:1100px; max-width:100%; display:grid; grid-template-columns: 1fr 360px; gap:18px;
    align-items:start;
    justify-content:center;
  }
  .panel{
    background:linear-gradient(180deg,var(--card), rgba(6,18,30,0.9)); padding:20px;border-radius:14px; box-shadow: 0 12px 40px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.03);
    display:flex; flex-direction: column; align-items: center;
  }
  .panel.left {
    justify-content: flex-start;
  }
  header h1{
    margin:0 0 6px 0;font-size:20px;color:var(--accent);
    text-align: center;
  }
  .topbar {
    display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:12px; flex-wrap: wrap;
    width: 100%;
  }
  .controls{
    display:flex;gap:8px;align-items:center;flex-wrap: wrap; justify-content:center;
  }
  .select, .input{
    padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;
    min-width: 120px;
  }
  .btn{
    padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#012;cursor:pointer;font-weight:700;box-shadow:0 8px 20px rgba(0,0,0,0.4);
  }
  .btn.ghost{
    background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600;
  }
  .mainArea{
    display:flex;gap:18px;align-items:flex-start; flex-direction: column; width: 100%;
  }
  .left{
    flex:1; display:flex; flex-direction: column; align-items: center;
  }
  .sentenceBox{
    background:var(--glass);padding:18px;border-radius:12px;min-height:140px;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;
    width: 100%;
  }
  .sentence{
    font-size:22px;text-align:center;color:#e8f7ff;line-height:1.3;
  }
  .explain{
    font-size:13px;color:var(--muted);opacity:0.95; text-align:center;
  }
  .battleRow{
    display:flex;gap:12px;margin-top:12px;align-items:center;justify-content:space-between; width: 100%;
    flex-wrap: wrap;
  }
  .player{
    flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));padding:12px;border-radius:12px;display:flex;flex-direction:column;gap:10px;align-items:center;
    min-width: 140px;
  }
  .player h3{
    margin:0;font-size:16px; text-align:center;
  }
  .scoreBig{
    font-size:28px;font-weight:800;color:var(--accent-2);
  }
  .actionBtns{
    display:flex;gap:8px;width:100%;justify-content:center;
  }
  .action{
    flex:1;padding:12px;border-radius:10px;border:none;font-weight:800;cursor:pointer;
  }
  .subj{
    background:linear-gradient(90deg,#38bdf8,#06b6d4);color:#022;
  }
  .ind{
    background:linear-gradient(90deg,#fb7185,#ef4444);color:#200;
  }
  .kbd{
    font-size:12px;color:var(--muted);opacity:0.9; text-align:center;
  }
  /* semaforo */
  .semaforoWrap{
    display:flex;flex-direction:column;align-items:center;gap:12px;
    min-width: 100px;
  }
  .semaforo{
    width:92px;padding:14px;border-radius:14px;background:linear-gradient(180deg,#071722,#022);border:6px solid rgba(255,255,255,0.03);
    display:flex;flex-direction:column;gap:10px;align-items:center;padding-top:18px;padding-bottom:18px;
  }
  .light{
    width:44px;height:44px;border-radius:50%;background:#111;border:4px solid rgba(0,0,0,0.3);box-shadow: inset 0 -6px 12px rgba(0,0,0,0.6);
  }
  .light.red.on{
    background:var(--red);box-shadow:0 6px 18px rgba(239,68,68,0.25);
  }
  .light.yellow.on{
    background:var(--yellow);box-shadow:0 6px 18px rgba(245,158,11,0.22);
  }
  .light.green.on{
    background:var(--green);box-shadow:0 6px 18px rgba(16,163,127,0.22);
  }
  .results{
    margin-top:12px;color:var(--muted);font-size:13px;text-align:center;
  }
  .rightCol{
    width:340px; display:flex; flex-direction: column; align-items: center;
  }
  .rightCol .panelHead{
    display:flex;align-items:center;justify-content:space-between;margin-bottom:8px; width: 100%;
  }
  .history{
    max-height:420px;overflow:auto;padding-top:6px;display:flex;flex-direction:column;gap:8px; width: 100%;
  }
  .histItem{
    display:flex;justify-content:space-between;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-left:6px solid rgba(255,255,255,0.02);
  }
  .histItem.correct{
    border-left-color:var(--green);color:#dfffe9;
  }
  .histItem.wrong{
    border-left-color:var(--red);color:#ffdede;
  }
  .footer{
    color:var(--muted);font-size:13px;margin-top:12px;text-align:center; max-width: 340px;
  }
  #timer {
    font-size: 16px;
    font-weight: 700;
    color: var(--accent-2);
    margin-bottom: 12px;
    text-align: center;
  }
  @media (max-width:1100px){
    .app{
      grid-template-columns:1fr;
      justify-items: center;
    }
    .rightCol {
      width: 100%;
      max-width: 380px;
      margin-top: 20px;
    }
  }
  @media (max-width:720px){
    .battleRow{
      flex-direction:column;
      align-items: center;
    }
    .semaforo{
      margin:12px 0;
    }
    .controls {
      justify-content: center;
    }
  }
</style>
</head>
<body>
  <div id="timer">Tempo restante: 01:00</div>
  <div class="app">
    <div class="panel left">
      <div class="topbar">
        <div>
          <header>
            <h1>Semáforo do Subjuntivo — Batalha</h1>
            <div class="explain">Modo Batalha: quem responder primeiro ganha a chance.</div>
          </header>
        </div>
        <div class="controls">
          <select id="mode" class="select">
            <option value="duo">Batalha (2 jogadores)</option>
            <option value="solo">Solo (prática)</option>
          </select>
          <select id="roundsSel" class="select">
            <option value="10">10 rodadas</option>
            <option value="15">15 rodadas</option>
            <option value="20" selected>20 rodadas</option>
            <option value="30">30 rodadas</option>
          </select>
          <select id="difficulty" class="select">
            <option value="easy">Fácil</option>
            <option value="medium" selected>Médio</option>
            <option value="hard">Difícil</option>
          </select>
          <button id="startBtn" class="btn">Iniciar</button>
        </div>
      </div>

      <div class="sentenceBox">
        <div id="sentence" class="sentence">Clique em Iniciar para começar a partida.</div>
        <div id="explain" class="explain"></div>
        <div class="battleRow" style="width:100%;">
          <div class="player" id="player1">
            <h3>Jogador 1</h3>
            <div class="scoreBig" id="score1">0</div>
            <div class="actionBtns">
              <button id="p1sub" class="action subj">SUBJ (A)</button>
              <button id="p1ind" class="action ind">IND (S)</button>
            </div>
            <div class="kbd">A = Subj • S = Ind</div>
          </div>

          <div class="semaforoWrap">
            <div class="semaforo" aria-hidden>
              <div class="light red" id="lightRed"></div>
              <div class="light yellow" id="lightYellow"></div>
              <div class="light green" id="lightGreen"></div>
            </div>
            <div class="results" id="roundHint">Pronto</div>
          </div>

          <div class="player" id="player2">
            <h3>Jogador 2</h3>
            <div class="scoreBig" id="score2">0</div>
            <div class="actionBtns">
              <button id="p2sub" class="action subj">SUBJ (K)</button>
              <button id="p2ind" class="action ind">IND (L)</button>
            </div>
            <div class="kbd">K = Subj • L = Ind</div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:10px;margin-top:12px;justify-content:center">
        <button id="nextBtn" class="btn ghost" disabled>Próxima</button>
        <button id="resetBtn" class="btn ghost">Reiniciar</button>
      </div>
    </div>

    <aside class="panel rightCol">
      <div class="panelHead">
        <div><strong>Status</strong></div>
        <div><small class="explain">Rodada: <span id="round">0</span>/<span id="total">20</span></small></div>
      </div>

      <div style="margin-top:6px">
        <div class="history" id="history"></div>
      </div>

      <div class="footer">Dicas rápidas: <br>• <em>ojalá, espero que, tal vez, para que, antes de que</em> normalmente pedem subjuntivo. • Use o modo <strong>Solo</strong> para treinar sem disputa.</div>
    </aside>
  </div>

<script>
/* Dados de frases ampliados por nível */
const bankEasy = [
  {s:'Espero que tú vengas mañana.', sub:true, x:'Desejo/esperança → subj.'},
  {s:'Sé que ella llega hoy.', sub:false, x:'Certeza → ind.'},
  {s:'Ella dice que trabaja mucho.', sub:false, x:'Fato reportado → ind.'},
  {s:'Cuando llegas, hablamos.', sub:false, x:'Hábitos/ações certas → ind.'},
  {s:'Creo que es posible.', sub:false, x:'Crença afirmativa → ind.'},
  {s:'Es verdad que lo sabemos.', sub:false, x:'Verdade → ind.'},
  {s:'Veo que él trabaja.', sub:false, x:'Observação direta → ind.'},
  {s:'Ella espera resultados.', sub:false, x:'Frase sem conector claro → ind.'},
  {s:'Ojalá que apruebes el examen.', sub:true, x:'Ojalá → desejo → subj.'},
  {s:'Te pido que me ayudes.', sub:true, x:'Pedido → subj.'},
  {s:'Me alegro de que estés bien.', sub:true, x:'Sentimento → subj.'},
  {s:'Antes de que salgas, cierra la puerta.', sub:true, x:'Antes de que → subj.'}
];

const bankMedium = [
  {s:'Quizás él tenga tiempo.', sub:true, x:'Dúvida/possibilidade → subj.'},
  {s:'Tal vez llueva esta tarde.', sub:true, x:'Tal vez → possibilidade → subj.'},
  {s:'Busco a alguien que hable español.', sub:true, x:'Procura não específica → subj.'},
  {s:'Es posible que ella llegue tarde.', sub:true, x:'Possibilidade → subj.'},
  {s:'No creo que eso sea cierto.', sub:true, x:'Negação de crença → subj.'},
  {s:'Para que estudies, apaga el móvil.', sub:true, x:'Finalidade → subj.'},
  {s:'Es mejor que descanses antes del examen.', sub:true, x:'Opinião com recomendação → subj.'},
  {s:'Sé que ellos tienen tiempo.', sub:false, x:'Saber → ind.'},
  {s:'Aunque haga frío, saldré.', sub:true, x:'Concessão → subj.'},
  {s:'No pienso que él venga hoy.', sub:true, x:'Negação → subj.'},
  {s:'Creo que es importante.', sub:false, x:'Crença afirmativa → ind.'}
];

const bankHard = [
  {s:'Dudo que él haya terminado.', sub:true, x:'Dúvida no passado → subj.'},
  {s:'Si tuviera tiempo, iría contigo.', sub:true, x:'Condição irreal → subj.'},
  {s:'Ojalá no llueva mañana.', sub:true, x:'Desejo irreal → subj.'},
  {s:'Es probable que hayan llegado.', sub:true, x:'Probabilidade → subj.'},
  {s:'No es cierto que él sea culpable.', sub:true, x:'Negação → subj.'},
  {s:'Buscamos un lugar que tenga sombra.', sub:true, x:'Procura específica → subj.'},
  {s:'No niego que ella es inteligente.', sub:false, x:'Afirmação → ind.'},
  {s:'Es verdad que hicieron el trabajo.', sub:false, x:'Verdade → ind.'},
  {s:'Sé que lo hicieron bien.', sub:false, x:'Saber → ind.'},
  {s:'Aunque sea difícil, lo intentaré.', sub:true, x:'Concessão → subj.'},
  {s:'No creo que haya problema.', sub:true, x:'Negação de crença → subj.'},
  {s:'Si hubiera sabido, habría venido.', sub:true, x:'Condicional passado → subj.'}
];

/* Estado do jogo */
let totalRounds = 20, rounds = 0;
let mode = 'duo';
let difficulty = 'medium';
let usedIdx = new Set();
let current = null;
let locked = false; // bloqueio para evitar múltiplos toques simultâneos
let score1 = 0, score2 = 0;
let autoNextTimeout = null;
let gameTimerInterval = null;
const totalGameTime = 60; // 5 minutes in seconds
let remainingTime = totalGameTime;

/* Elementos DOM */
const sentenceEl = document.getElementById('sentence');
const explainEl = document.getElementById('explain');
const roundEl = document.getElementById('round');
const totalEl = document.getElementById('total');
const historyEl = document.getElementById('history');
const roundHint = document.getElementById('roundHint');
const timerEl = document.getElementById('timer');

const p1sub = document.getElementById('p1sub'), p1ind = document.getElementById('p1ind');
const p2sub = document.getElementById('p2sub'), p2ind = document.getElementById('p2ind');
const score1El = document.getElementById('score1'), score2El = document.getElementById('score2');

const lightRed = document.getElementById('lightRed'), lightYellow = document.getElementById('lightYellow'), lightGreen = document.getElementById('lightGreen');

const startBtn = document.getElementById('startBtn'), nextBtn = document.getElementById('nextBtn'), resetBtn = document.getElementById('resetBtn');
const modeSel = document.getElementById('mode'), roundsSel = document.getElementById('roundsSel'), diffSel = document.getElementById('difficulty');

/* Função atualizada para escolher a frase conforme nível e evitar repetição */
function pickSentence(){
  let pool;
  const level = diffSel.value;
  if(level === 'easy') pool = bankEasy;
  else if(level === 'medium') pool = bankMedium;
  else pool = bankHard;
  
  if(usedIdx.size >= pool.length) usedIdx.clear();

  let idx;
  do {
    idx = Math.floor(Math.random()*pool.length);
  } while(usedIdx.has(idx) && usedIdx.size < pool.length);

  usedIdx.add(idx);
  return pool[idx];
}

/* UI updates */
function updateScores(){ score1El.textContent = score1; score2El.textContent = score2; roundEl.textContent = rounds; totalEl.textContent = totalRounds; }
function appendHistory(text, who, correct){
  const d = document.createElement('div'); d.className = 'histItem ' + (correct? 'correct' : 'wrong');
  d.innerHTML = `<div style="max-width:75%"><strong>${who? who : '—'}</strong> ${text}</div><div>${correct? '✔' : '✖'}</div>`;
  historyEl.prepend(d);
  // cap
  while(historyEl.children.length > 30) historyEl.removeChild(historyEl.lastChild);
}

/* Semáforo animation: yellow blink then green or red */
function flashSemaphore(result){ // result: 'green'|'red'
  // reset
  lightRed.classList.remove('on'); lightYellow.classList.remove('on'); lightGreen.classList.remove('on');
  lightYellow.classList.add('on');
  roundHint.textContent = 'Respondendo...';
  // after delay, show result
  setTimeout(()=> {
    lightYellow.classList.remove('on');
    if(result === 'green') lightGreen.classList.add('on');
    else lightRed.classList.add('on');
    // clear after a bit
    setTimeout(()=> {
      lightGreen.classList.remove('on'); lightRed.classList.remove('on');
      roundHint.textContent = 'Pronto';
    }, 900);
  }, 700);
}

/* Begin round: show sentence and enable answers */
function startRound(){
  if(rounds >= totalRounds){ finishGame(); return; }
  current = pickSentence();
  sentenceEl.textContent = current.s;
  explainEl.textContent = '';
  locked = false;
  nextBtn.disabled = true;
  nextBtn.textContent = 'Próxima';
  // enable buttons
  [p1sub,p1ind,p2sub,p2ind].forEach(b=>{ b.disabled=false; b.style.opacity=1; });
  // show small animation cue
  lightYellow.classList.add('on');
  setTimeout(()=> lightYellow.classList.remove('on'), 300);
}

/* Handle press: player (1 or 2) answers subj=true/false */
function handlePress(player, isSubj){
  if(locked) return; // someone already answered
  locked = true;
  // disable inputs
  [p1sub,p1ind,p2sub,p2ind].forEach(b=> b.disabled=true);
  rounds++;
  const correct = (isSubj === current.sub);
  // indicate via semáforo
  flashSemaphore(correct? 'green' : 'red');
  // scoring
  if(player === 1){
    if(correct) { score1 += 10; score2 -= 3; if(score2<0) score2=0; }
    else { score1 -= 5; if(score1<0) score1=0; score2 += 5; }
  } else if(player === 2){
    if(correct) { score2 += 10; score1 -= 3; if(score1<0) score1=0; }
    else { score2 -= 5; if(score2<0) score2=0; score1 += 5; }
  } else {
    if(correct) score1 += 10;
    else score1 = Math.max(0, score1-3);
  }
  // history & explain
  appendHistory(current.s + ` — ${current.x}`, player? `Jogador ${player}` : 'Solo', correct);
  explainEl.textContent = (correct? 'Correto!' : 'Errado —') + ' ' + current.x;
  updateScores();
  // auto next round after 1s
  if(autoNextTimeout) clearTimeout(autoNextTimeout);
  autoNextTimeout = setTimeout(() => {
    if(rounds >= totalRounds){
      finishGame();
    } else {
      startRound();
    }
  }, 1000);
}

/* Finish */
function finishGame(){
  clearInterval(gameTimerInterval);
  sentenceEl.textContent = `Fim! Resultado — Jog1: ${score1} • Jog2: ${score2}`;
  explainEl.textContent = 'Clique Reiniciar para jogar novamente.';
  [p1sub,p1ind,p2sub,p2ind].forEach(b=> b.disabled=true);
  nextBtn.disabled = true;
  timerEl.textContent = 'Tempo esgotado ou jogo finalizado!';
}

/* Timer update */
function updateTimer(){
  if(remainingTime <= 0){
    finishGame();
    return;
  }
  const min = String(Math.floor(remainingTime/60)).padStart(2,'0');
  const sec = String(remainingTime % 60).padStart(2,'0');
  timerEl.textContent = `Tempo restante: ${min}:${sec}`;
  remainingTime--;
}

/* Bind UI events */
p1sub.addEventListener('click', ()=> handlePress(1, true));
p1ind.addEventListener('click', ()=> handlePress(1, false));
p2sub.addEventListener('click', ()=> handlePress(2, true));
p2ind.addEventListener('click', ()=> handlePress(2, false));

/* keyboard shortcuts */
window.addEventListener('keydown', (e)=>{
  if(mode !== 'duo' && mode !== 'solo') return;
  const key = e.key.toLowerCase();
  if(key === 'a') p1sub.click();
  if(key === 's') p1ind.click();
  if(key === 'k') p2sub.click();
  if(key === 'l') p2ind.click();
});

/* start, next, reset */
startBtn.addEventListener('click', ()=>{
  mode = modeSel.value;
  totalRounds = parseInt(roundsSel.value,10);
  difficulty = diffSel.value;
  rounds = 0; score1 = 0; score2 = 0; usedIdx.clear(); historyEl.innerHTML='';
  totalEl.textContent = totalRounds;
  updateScores();
  nextBtn.textContent = 'Próxima';
  nextBtn.disabled = true;
  remainingTime = totalGameTime;
  updateTimer();
  clearInterval(gameTimerInterval);
  gameTimerInterval = setInterval(updateTimer, 1000);
  startRound();
});
nextBtn.addEventListener('click', ()=>{
  if(rounds >= totalRounds){ finishGame(); return; }
  startRound();
});
resetBtn.addEventListener('click', ()=> {
  rounds = 0; score1 = 0; score2 = 0; usedIdx.clear(); historyEl.innerHTML='';
  updateScores(); sentenceEl.textContent = 'Partida reiniciada. Clique em Iniciar.'; explainEl.textContent='';
  nextBtn.disabled = true;
  clearInterval(gameTimerInterval);
  remainingTime = totalGameTime;
  updateTimer();
});

/* small safety: disable text selection on buttons while playing */
document.querySelectorAll('button').forEach(b=> b.addEventListener('mousedown', e=> e.preventDefault()));

/* init visuals */
updateScores();
totalEl.textContent = totalRounds;
roundHint.textContent = 'Pronto';
timerEl.textContent = "Tempo restante: 01:00";
</script>
</body>
  </html>
